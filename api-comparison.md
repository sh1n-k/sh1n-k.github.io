---
layout: default
title: API 비교 분석
nav_order: 3
---

# API 비교 분석

이 페이지는 CloudMsg와 SendTalk의 API 차이점을 “나열”하는 것이 아니라, **서버 설계에 어떤 구조적 결정을 강제하는지**에 초점을 둔다. 결론적으로, 두 업체의 차이는 “발송 서비스가 업체 SDK/HTTP 호출에 직접 의존하면 유지보수가 깨진다”는 신호이므로, **Provider 추상화 + 내부 도메인 모델 표준화 + Webhook 분리 처리**가 합리적이다.

## **공통점(설계에 유리한 지점)**

두 업체가 공통으로 제공한다고 가정한 영역(문제/대화 기반):
- **지원 메시지 유형이 겹친다**: SMS, MMS/LMS, 알림톡 (앱 푸시는 범위 밖)
- **결과가 비동기(Webhook)로 돌아올 수 있다**: 요청 시점과 결과 수신 시점이 분리됨

설계 영향:
- 발송 이력은 **“요청 접수”와 “결과 수신”**을 분리해 상태 머신으로 관리해야 한다.
- “발송 요청” API는 즉시 성공/실패가 아니라 **접수(QUEUED/ACCEPTED)** 개념을 반환할 수 있으므로, 사용자 응답과 운영 모니터링 기준을 분리한다.

## **차이점(설계를 바꾸는 지점)과 처리 전략**

1) **인증 방식 차이**
- CloudMsg: 서명 기반(HMAC-SHA256, Access/Secret/Timestamp 등)
- SendTalk: 토큰 기반(Bearer API Key 등)

처리 전략:
- 인증은 발송 서비스가 직접 다루지 않고 **Provider 내부 책임**으로 둔다.
- 관리 화면에서 “키가 맞는지” 확인하려면 **Provider 단위 `validateCredentials()`** 같은 공통 훅이 필요하다.

2) **엔드포인트 구조 차이**
- CloudMsg: 통합 엔드포인트(예: `POST /messages`)
- SendTalk: 메시지 타입별 분리(예: `/sms/send`, `/mms/send`, `/kakao/alimtalk`)

처리 전략:
- 내부 인터페이스는 (a) 타입별 메서드 또는 (b) 단일 메서드+타입 파라미터 중 선택이 필요하다.  
- 운영/가독성 관점에서는 **타입별 메서드(SMS/MMS/알림톡)**가 명시적이고, CloudMsg 구현체가 내부에서 통합 호출로 매핑하면 된다.

3) **전화번호 포맷 차이**
- CloudMsg: E.164(예: `+821012345678`)
- SendTalk: 로컬(예: `01012345678`)

처리 전략:
- 내부 도메인 모델은 **한 가지 포맷으로 표준화**(권장: E.164)하고, Provider에서 변환한다.
- 관리자 화면/발송 API 입력 값이 섞일 수 있으므로, 서버에서 **정규화/검증**을 수행하고 실패 시 명확한 에러를 준다.

4) **알림톡 필드/용어 차이**
- CloudMsg: `templateId`, `params`
- SendTalk: `templateCode`, `variables` (예시)

처리 전략:
- 내부 모델은 중립 용어로 정의한다(예: `templateKey`, `variables` 같은 superset).
- 버튼 타입/옵션 같은 “세부 기능 차이”는 누락 위험이 크므로, 변환 로직에 대해 **단위 테스트 + 샘플 페이로드 기반 통합 테스트**를 필수로 둔다.

5) **Webhook 페이로드/서명 검증 차이**
- 페이로드 구조, 서명 헤더/검증 방식이 업체마다 다를 가능성이 높다.

처리 전략:
- Webhook 엔드포인트는 **업체별로 분리**(`/webhook/cloudmsg`, `/webhook/sendtalk`)하는 편이 안전하다.
- 내부적으로는 공통 처리(이력 상태 업데이트, 멱등성 키, 수신 시각 기록)를 재사용하되, 파싱/검증만 분리한다.

## **이 페이지 결론(설계로 연결되는 핵심)**

- 두 업체 차이는 “필드 매핑” 문제가 아니라, **의존성 경계(Provider) 설정** 문제다.
- 내부에서 표준화할 것: **전화번호 포맷, 메시지 타입 모델, 알림톡 변수 구조, 발송 상태 모델**
- 업체별로 분리할 것: **인증/서명, 엔드포인트 호출, Webhook 검증/파싱**
---
